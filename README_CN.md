# 红外相机风格迁移工具

这是一个基于Python和OpenCV实现的简单工具，用于从一系列由特定红外相机拍摄的图像中提取其独特的传感器“指纹”（包括渐晕效应和固定模式噪声），并将其应用到其他“干净”的图像上，从而实现一种风格迁移，使后者看起来像是用那台特定的红外相机拍摄的。

该项目遵循一种简单有效的统计学方法：通过平均大量图像来消除场景内容，从而分离出传感器固有的、不变的模式。

## ✨ 功能特性

- **特征提取**: 自动分析指定目录下的所有图像，提取相机的渐晕图（低频）和噪声图（高频）。
- **风格迁移**: 将提取出的相机指纹应用到任意干净图像上。
- **配置驱动**: 所有路径和算法参数均通过 `config.yaml` 文件进行管理，无需修改代码。
- **模块化设计**: 代码结构清晰，分为数据分析和风格应用两大模块，易于理解和扩展。
- **命令行操作**: 提供简单的主执行入口 `main.py`，通过命令行参数即可控制全部流程。

## 🔧 项目结构

```
infrared-style-transfer/
├── data/
│   ├── raw_images/       # 存放用于分析的原始红外图像
│   └── clean_images/     # 存放待处理的干净图像
├── output/
│   ├── camera_fingerprint/ # 存储提取出的相机指纹
│   └── stylized_images/    # 存储最终生成的风格化图像
├── src/
│   ├── camera_analyzer.py    # 核心模块1：特征提取
│   └── style_applicator.py   # 核心模块2：风格应用
├── main.py                 # 项目主执行脚本
├── config.yaml             # 配置文件
├── requirements.txt        # Python依赖列表
└── README.md               # 项目说明文档
```

## 🚀 快速开始

### 1. 环境准备

首先，克隆或下载本项目，并确保您已安装 Python 3.x。

然后，在项目根目录下，使用pip安装所有必要的依赖库：
```bash
pip install -r requirements.txt
```

### 2. 准备数据

- **原始图像**: 将大量（建议50张以上）由目标红外相机拍摄的、内容各异的图像放入 `data/raw_images/` 目录中。
- **干净图像**: 将您希望添加相机风格的“干净”图像放入 `data/clean_images/` 目录中。

### 3. (可选) 调整配置

打开 `config.yaml` 文件。您可以根据需要调整图像处理分辨率、高斯模糊核大小、噪声强度等参数。默认配置适用于大多数情况。

### 4. 执行任务

在项目的根目录下打开终端，执行以下命令：

- **第一步：提取相机指纹**
  ```bash
  python main.py extract
  ```
  此命令会分析 `data/raw_images/` 中的图像，并将提取的 `vignetting_map.exr` 和 `noise_map.exr` 保存到 `output/camera_fingerprint/` 目录。

- **第二步：应用风格**
  ```bash
  python main.py apply
  ```
  此命令会加载已提取的指纹，处理 `data/clean_images/` 中的所有图像，并将结果保存到 `output/stylized_images/`。

- **一步到位：执行完整流程**
  ```bash
  python main.py all
  ```
  此命令会连续执行提取和应用两个步骤。

## 🛠️ 技术原理

本工具基于一个核心假设：`图像 = 场景内容 + 传感器固定模式`。

当对大量不同场景的图像求平均时，随机的“场景内容”会相互抵消，趋向于一个平滑的均值。而“传感器固定模式”（如像素响应不均匀性PRNU和镜头渐晕）作为一种固定偏差，会在平均过程中被保留并强化。通过进一步的高斯模糊和图像减法，我们可以将这种固定模式分离为低频的渐晕分量和高频的噪声分量，即相机的“指纹”。